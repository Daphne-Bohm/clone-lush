(function ($) {

  'use strict';

  if (Drupal.ajax !== undefined) {
    // Create a custom command to manage the Packery library.
    Drupal.ajax.prototype.commands.packeryadd = function (ajax, response, status) {
      if (response) {
        var selector = response.selector ? $(response.selector) : $(ajax.wrapper);
        var elements = response.elements;

        var $container = $(selector);
        var pckry = $container.data('packery');

        $(elements).each(function(index) {
          var element = $(elements[index]);
          $container.append(element);
          pckry.appended(element);
        });
        
        $container.imagesLoaded(function() {
          pckry.layout();
        });
      }
    };
  };

})(jQuery);