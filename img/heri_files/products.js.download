
(function ($) {
    Drupal.behaviors.products = {
        attach: function (context, settings) {

            $(document).ready(function() {
                //Adding ajax call for load more review
                $('a.load-more-products').click(function (e) {
                    $(this).addClass('working');
                    var nid = parseInt($(this).attr('id'));
                    var count = parseInt($(this).attr('products-loaded'));

                    $('#load-more-products').append('<div id="replace-products"/>');
                    $('#replace-products').load('/ajax/get/products/'+nid+'/4/'+count, function(responseText, textStatus, req) {
                        if (textStatus == "error") {
                            $('a.load-more-products').toggleClass('working');
                            $('#replace-products').replaceWith('<div class="ajax-error">Cannot connect to server!</div>');
                        }
                        else {
                            $('a.load-more-products').attr('products-loaded', count+4);
                            $('a.load-more-products').removeClass('working');
                            $('.load-more-products-wrapper').removeClass('closed');
                            $(this).removeAttr('id');
                        }
                    });
                    e.preventDefault();
                });
            });

        }
    };
})(jQuery);